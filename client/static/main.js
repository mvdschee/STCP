// Copyright (c) 2022 - Max van der Schee; Licensed MIT
var L,d,q,se,N,F,le,T={},z=[],ie=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function b(t,e){for(var n in e)t[n]=e[n];return t}function J(t){var e=t.parentNode;e&&e.removeChild(t)}function y(t,e,n){var _,s,o,a={};for(o in e)o=="key"?_=e[o]:o=="ref"?s=e[o]:a[o]=e[o];if(arguments.length>2&&(a.children=arguments.length>3?L.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)a[o]===void 0&&(a[o]=t.defaultProps[o]);return D(t,a,_,s,null)}function D(t,e,n,_,s){var o={type:t,props:e,key:n,ref:_,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s??++q};return s==null&&d.vnode!=null&&d.vnode(o),o}function A(t){return t.children}function S(t,e){this.props=t,this.context=e}function x(t,e){if(e==null)return t.__?x(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?x(t):null}function K(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return K(t)}}function B(t){(!t.__d&&(t.__d=!0)&&N.push(t)&&!P.__r++||F!==d.debounceRendering)&&((F=d.debounceRendering)||setTimeout)(P)}function P(){for(var t;P.__r=N.length;)t=N.sort(function(e,n){return e.__v.__b-n.__v.__b}),N=[],t.some(function(e){var n,_,s,o,a,c;e.__d&&(a=(o=(n=e).__v).__e,(c=n.__P)&&(_=[],(s=b({},o)).__v=o.__v+1,R(c,o,s,n.__n,c.ownerSVGElement!==void 0,o.__h!=null?[a]:null,_,a??x(o),o.__h),Z(_,o),o.__e!=a&&K(o)))})}function Q(t,e,n,_,s,o,a,c,p,f){var r,m,i,l,u,C,h,v=_&&_.__k||z,k=v.length;for(n.__k=[],r=0;r<e.length;r++)if((l=n.__k[r]=(l=e[r])==null||typeof l=="boolean"?null:typeof l=="string"||typeof l=="number"||typeof l=="bigint"?D(null,l,null,null,l):Array.isArray(l)?D(A,{children:l},null,null,null):l.__b>0?D(l.type,l.props,l.key,null,l.__v):l)!=null){if(l.__=n,l.__b=n.__b+1,(i=v[r])===null||i&&l.key==i.key&&l.type===i.type)v[r]=void 0;else for(m=0;m<k;m++){if((i=v[m])&&l.key==i.key&&l.type===i.type){v[m]=void 0;break}i=null}R(t,l,i=i||T,s,o,a,c,p,f),u=l.__e,(m=l.ref)&&i.ref!=m&&(h||(h=[]),i.ref&&h.push(i.ref,null,l),h.push(m,l.__c||u,l)),u!=null?(C==null&&(C=u),typeof l.type=="function"&&l.__k===i.__k?l.__d=p=X(l,p,t):p=Y(t,l,i,v,u,p),typeof n.type=="function"&&(n.__d=p)):p&&i.__e==p&&p.parentNode!=t&&(p=x(i))}for(n.__e=C,r=k;r--;)v[r]!=null&&(typeof n.type=="function"&&v[r].__e!=null&&v[r].__e==n.__d&&(n.__d=x(_,r+1)),te(v[r],v[r]));if(h)for(r=0;r<h.length;r++)ee(h[r],h[++r],h[++r])}function X(t,e,n){for(var _,s=t.__k,o=0;s&&o<s.length;o++)(_=s[o])&&(_.__=t,e=typeof _.type=="function"?X(_,e,n):Y(n,_,_,s,_.__e,e));return e}function Y(t,e,n,_,s,o){var a,c,p;if(e.__d!==void 0)a=e.__d,e.__d=void 0;else if(n==null||s!=o||s.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(s),a=null;else{for(c=o,p=0;(c=c.nextSibling)&&p<_.length;p+=2)if(c==s)break e;t.insertBefore(s,o),a=o}return a!==void 0?a:s.nextSibling}function ae(t,e,n,_,s){var o;for(o in n)o==="children"||o==="key"||o in e||U(t,o,null,n[o],_);for(o in e)s&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===e[o]||U(t,o,e[o],n[o],_)}function G(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||ie.test(e)?n:n+"px"}function U(t,e,n,_,s){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof _=="string"&&(t.style.cssText=_=""),_)for(e in _)n&&e in n||G(t.style,e,"");if(n)for(e in n)_&&n[e]===_[e]||G(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?_||t.addEventListener(e,o?j:V,o):t.removeEventListener(e,o?j:V,o);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function V(t){this.l[t.type+!1](d.event?d.event(t):t)}function j(t){this.l[t.type+!0](d.event?d.event(t):t)}function R(t,e,n,_,s,o,a,c,p){var f,r,m,i,l,u,C,h,v,k,E,H,w,g=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(p=n.__h,c=e.__e=n.__e,e.__h=null,o=[c]),(f=d.__b)&&f(e);try{e:if(typeof g=="function"){if(h=e.props,v=(f=g.contextType)&&_[f.__c],k=f?v?v.props.value:f.__:_,n.__c?C=(r=e.__c=n.__c).__=r.__E:("prototype"in g&&g.prototype.render?e.__c=r=new g(h,k):(e.__c=r=new S(h,k),r.constructor=g,r.render=ce),v&&v.sub(r),r.props=h,r.state||(r.state={}),r.context=k,r.__n=_,m=r.__d=!0,r.__h=[]),r.__s==null&&(r.__s=r.state),g.getDerivedStateFromProps!=null&&(r.__s==r.state&&(r.__s=b({},r.__s)),b(r.__s,g.getDerivedStateFromProps(h,r.__s))),i=r.props,l=r.state,m)g.getDerivedStateFromProps==null&&r.componentWillMount!=null&&r.componentWillMount(),r.componentDidMount!=null&&r.__h.push(r.componentDidMount);else{if(g.getDerivedStateFromProps==null&&h!==i&&r.componentWillReceiveProps!=null&&r.componentWillReceiveProps(h,k),!r.__e&&r.shouldComponentUpdate!=null&&r.shouldComponentUpdate(h,r.__s,k)===!1||e.__v===n.__v){r.props=h,r.state=r.__s,e.__v!==n.__v&&(r.__d=!1),r.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(M){M&&(M.__=e)}),r.__h.length&&a.push(r);break e}r.componentWillUpdate!=null&&r.componentWillUpdate(h,r.__s,k),r.componentDidUpdate!=null&&r.__h.push(function(){r.componentDidUpdate(i,l,u)})}if(r.context=k,r.props=h,r.__v=e,r.__P=t,E=d.__r,H=0,"prototype"in g&&g.prototype.render)r.state=r.__s,r.__d=!1,E&&E(e),f=r.render(r.props,r.state,r.context);else do r.__d=!1,E&&E(e),f=r.render(r.props,r.state,r.context),r.state=r.__s;while(r.__d&&++H<25);r.state=r.__s,r.getChildContext!=null&&(_=b(b({},_),r.getChildContext())),m||r.getSnapshotBeforeUpdate==null||(u=r.getSnapshotBeforeUpdate(i,l)),w=f!=null&&f.type===A&&f.key==null?f.props.children:f,Q(t,Array.isArray(w)?w:[w],e,n,_,s,o,a,c,p),r.base=e.__e,e.__h=null,r.__h.length&&a.push(r),C&&(r.__E=r.__=null),r.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=ue(n.__e,e,n,_,s,o,a,p);(f=d.diffed)&&f(e)}catch(M){e.__v=null,(p||o!=null)&&(e.__e=c,e.__h=!!p,o[o.indexOf(c)]=null),d.__e(M,e,n)}}function Z(t,e){d.__c&&d.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(_){_.call(n)})}catch(_){d.__e(_,n.__v)}})}function ue(t,e,n,_,s,o,a,c){var p,f,r,m=n.props,i=e.props,l=e.type,u=0;if(l==="svg"&&(s=!0),o!=null){for(;u<o.length;u++)if((p=o[u])&&"setAttribute"in p==!!l&&(l?p.localName===l:p.nodeType===3)){t=p,o[u]=null;break}}if(t==null){if(l===null)return document.createTextNode(i);t=s?document.createElementNS("http://www.w3.org/2000/svg",l):document.createElement(l,i.is&&i),o=null,c=!1}if(l===null)m===i||c&&t.data===i||(t.data=i);else{if(o=o&&L.call(t.childNodes),f=(m=n.props||T).dangerouslySetInnerHTML,r=i.dangerouslySetInnerHTML,!c){if(o!=null)for(m={},u=0;u<t.attributes.length;u++)m[t.attributes[u].name]=t.attributes[u].value;(r||f)&&(r&&(f&&r.__html==f.__html||r.__html===t.innerHTML)||(t.innerHTML=r&&r.__html||""))}if(ae(t,i,m,s,c),r)e.__k=[];else if(u=e.props.children,Q(t,Array.isArray(u)?u:[u],e,n,_,s&&l!=="foreignObject",o,a,o?o[0]:n.__k&&x(n,0),c),o!=null)for(u=o.length;u--;)o[u]!=null&&J(o[u]);c||("value"in i&&(u=i.value)!==void 0&&(u!==t.value||l==="progress"&&!u||l==="option"&&u!==m.value)&&U(t,"value",u,m.value,!1),"checked"in i&&(u=i.checked)!==void 0&&u!==t.checked&&U(t,"checked",u,m.checked,!1))}return t}function ee(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(_){d.__e(_,n)}}function te(t,e,n){var _,s;if(d.unmount&&d.unmount(t),(_=t.ref)&&(_.current&&_.current!==t.__e||ee(_,null,e)),(_=t.__c)!=null){if(_.componentWillUnmount)try{_.componentWillUnmount()}catch(o){d.__e(o,e)}_.base=_.__P=null}if(_=t.__k)for(s=0;s<_.length;s++)_[s]&&te(_[s],e,typeof t.type!="function");n||t.__e==null||J(t.__e),t.__e=t.__d=void 0}function ce(t,e,n){return this.constructor(t,n)}function ne(t,e,n){var _,s,o;d.__&&d.__(t,e),s=(_=typeof n=="function")?null:n&&n.__k||e.__k,o=[],R(e,t=(!_&&n||e).__k=y(A,null,[t]),s||T,T,e.ownerSVGElement!==void 0,!_&&n?[n]:s?null:e.firstChild?L.call(e.childNodes):null,o,!_&&n?n:s?s.__e:e.firstChild,_),Z(o,t)}L=z.slice,d={__e:function(t,e,n,_){for(var s,o,a;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(t)),a=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,_||{}),a=s.__d),a)return s.__E=s}catch(c){t=c}throw t}},q=0,se=function(t){return t!=null&&t.constructor===void 0},S.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=b({},this.state),typeof t=="function"&&(t=t(b({},n),this.props)),t&&b(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),B(this))},S.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),B(this))},S.prototype.render=A,N=[],P.__r=0,le=0;var re="https://stcp.deno.dev",O=new Map,W=0;function oe({stateUpdate:t,stateChange:e,stateSetup:n}){let _=new EventSource(`${re}/listen`);_.addEventListener("open",()=>{W=new Date().valueOf(),n&&n("CONNECTED")}),_.addEventListener("error",()=>{switch(_.readyState){case EventSource.OPEN:e&&e("CONNECTED");break;case EventSource.CONNECTING:e&&e("CONNECTING");break;case EventSource.CLOSED:e&&e("DISCONNECTED");break}}),_.addEventListener("message",s=>{let o=JSON.parse(s.data),[a,c,p]=o.split(":");a==="msg"&&(O.get(c)?O.get(c).push({time:W+s.timeStamp,message:p}):O.set(c,[{time:W+s.timeStamp,message:p}]),t(O,"msg"))})}async function _e({type:t,message:e,name:n}){try{await fetch(`${re}/send?msg=${t}:${n}:${e}`)}catch(_){console.error(_)}}var $=class extends S{constructor(){super(...arguments);this.state={value:""};this.onSubmit=n=>{n.preventDefault(),_e({type:"msg",message:this.state.value,name:"Max"}),this.setState({value:""})};this.onInput=n=>{let{value:_}=n.target;this.setState({value:_})}}render(n,{value:_}){return y("form",{class:"message-input",onSubmit:this.onSubmit},y("input",{type:"text",value:_,onInput:this.onInput,autofocus:!0}),y("button",{class:"btn btn--primary",type:"submit"},"Submit"))}};var I=class extends S{constructor(){super();this.updateMessages=(n,_)=>{this.setState({users:n})};this.timestamp=n=>{let _=new Date(n),s=_.getHours(),o=_.getMinutes();return`${s}:${o<10?"0"+o:o}`};this.state={users:new Map}}componentDidMount(){oe({stateUpdate:this.updateMessages})}render(){let n=this.state.users.get("Max");return y("main",{class:"main"},y("h1",null,"Secure Chat"),y("ul",{class:"message-group"},n&&n.map(({time:_,message:s})=>y("li",{class:"message-item",key:_},y("small",null,this.timestamp(_)),y("p",null,s)))),y($,null))}};var pe=document.querySelector("#app"),fe=y(I,null);ne(fe,pe);
